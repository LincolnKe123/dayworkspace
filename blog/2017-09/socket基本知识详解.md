# socket基本知识详解

## 套接字
套接字是计算机网络数据结构。在任何类型的通信开始前，网络应用程序必须创建套接字。可以将他们比作电话的插孔，没有他将无法进行通信。

套接字最初是为同一主机上的应用程序所创建，使主机上运行一个程序(又名一个进程)，与另一个运行的程序进行通信这就是所谓的**进程间通信**(IPC)

有两种类型的套接字：**基于文件的**，**面向网络的**

UNIX 套接字是我们所讲的套接字的第一个家族，并且拥有一个"家族名字" AF_UNIX(又名 AF_LOCAL),它代表的地址家族(address family):UNIX。所以大多时候都会缩写为 AF Python 支持 AF_UNIX

因为两个进程运行在同一台计算机上，所以这些套接字都是基于文件的，这意味着文件系统支持他们的底层基础结构。这是能够说通的，因为文件系统是一个运行在同一主机上的多个进程之间的共享常量。

第二种类型的套接字是基于网络的，他有自己的家族名字 AF_INET 或者*家族地址*:因特网。另一个家族地址 AF_INET6 用于第六版因特网协议(IPV6) 寻址。此外还有其他的地址家族，这些要么是专业的，过时的，很少用的，要么是仍未实现的。在所有的地址家族之中。目前 AF_INET 是使用最广泛的。

## 套接字地址：主机-端口对

如果一个套接字像一个电话插孔----允许通信的一些基础设施，那么主机名和端口号就像区号和电话号码的组合。然而有硬件和通信能力本身并没有任何好处，除非你知道把电话打给谁和如何拨打电话。一个网络地址由主机名和端口号组成。而这是网络通信所需要的。此外未事先说明必须有其他人在另一端接听；否则，你将听到这个熟悉的声音“对不起,你所拨打的号码是空号，请核对后再拨”。你还有可能已经在浏览网页的过程中见过一个网络类比，例如：“无法连接服务器，服务器没有相应或服务器不可达”

有效的端口号范围是 **0-65535**(尽管小于1024的端口号是预留给系统的)。如果你正在使用POSIX兼容系统(例如 Linux ，Mac os)那么可以在/etc/servicesz找到预留端口列表

    ftp-data           20/tcp
    ftp-data           20/udp
    ftp-data           20/sctp
    ftp                21/tcp
    ftp                21/udp
    ftp                21/sctp
    ssh                22/tcp
    ssh                22/udp
    ssh                22/sctp
    telnet             23/tcp
    telnet             23/udp
    smtp               25/tcp
    smtp               25/udp
    http               80/tcp
    http               80/udp
    www                80/tcp
    www                80/udp
    www-http           80/tcp
    www-http           80/udp
    http               80/sctp
    https             443/tcp
    https             443/udp
    https             443/sctp

我在这里列出了一些常用的服务对应的端口

## 面向连接的套接字和面向无连接的套接字

### 面向连接的套接字

不管你采用那种地址家族，都有两种不同风格的套接字连接。第一种是面向连接的，则意味着在通信之前必须要先建立一个连接，例如，使用电话给一个朋友打电话。这种类型的通信也称为*虚拟电路*或者*流套接字*

面向连接的通信提供**序列化**的**可靠**的和**不重复**的数据交付,而没有记录边界。这基本意味着每一条消息可以拆分成多个片断并且每一条消息片段都确保能够到达目的地，然后将他们按顺序组合在一起，最后将完整的消息传递给正在等待的应用程序。

实现这种连接类型的主要协议是*传输控制协议*(更为人熟知的是他的缩写 TCP)。为了创建TCP套接字必须使用 **SOCK_STREAM** 作为**套接字类型**.TCP 套接字的名字 SOCK\_STREAM 基于流套接字的一种表示。因为这些套接字(AF\_INET)的网络版本使用*因特网协议*(IP)来搜寻网络中的h主机。所以整个系统结合h这两种协议(TCP和IP)来进行(当然也可以使用TCP和本地[非网络的AF\_LOCAL/AF\_UNIX])套接字，但是很明显此时并没有使用IP）。


### 无连接的套接字

与虚拟电路形成鲜明对比的是数据报类型的套接字，它是一种无连接的套接字。这意味着，在通信开始之前不用建立连接，此时数据传输过程中并**无法保证**他的**顺序性**,**可靠性**或**重复性**，然而数据报确实保存了记录边界，这意味着消息以整体发出，而并非首先分成多个片段，例如面向连接的协议。

使用数据报的消息传输可以比作邮政服务。信件和包裹并不能以发送顺序到达。事实上可能不会到达为了添加到并发通信中，在网络中甚至有可能存在重复的消息。

既然有那么多的副作用为什么还是用数据报呢(使用流套接字肯定有一些优势)？由于面向连接的套接字所提供的保证。因此他们的设置以及对虚拟电路的维护需要大量的开销。然而数据报不需要这样的开销，即他的成本更加的*低廉*.因此他们h通常能提供更好的性能，并且可能适合一些类型的应用程序。

实现这种连接的主要协议是*用户数据报协议*(更为人熟知的是其缩写(UDP))。为了创建 UDP 套接字必须使用 **SOCK_DGRAM** 作为套接字类型。你可能知道 UDP 套接字的 **SOCK\_DGRAM** 来自于单词 datagram(数据报)。e因为这些套接字也使用了因特网协议来a寻找网络中的主机所以这个系统有更加普通的名字**UDP/IP**。
