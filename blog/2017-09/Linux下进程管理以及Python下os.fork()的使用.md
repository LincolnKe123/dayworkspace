# Linux下进程管理以及Python下os.fork()的使用

前几天我写了一个多人聊天室，那个我最开始就用 fork 实现的。然后我就有一点不明白就是我每连接一个用户我就会fork一个进程。然后我就懵了啊。用户多了不就完蛋了吗？没有办法只好用多线程写的。

## fork() 简介

Linux 创建进程采用fork() 和 exec()

1. fork: 采用复制当前进程的方式来创建子进程，此时子进程和父进程的区别仅在于 pid ，ppid以及资源统计量(比如挂起的信号).

2. exec: 读取可执行文件载入地址空间执行；一般称之为 exec 函数族，有一系列exec的开头的函数，比如 execl，execve等。

fork 过程复制资源包括代码段，数据段，堆，栈。fork调用者所在的进程便是父进程，新创建的进程是子进程；在 fork 调用结束，从内核返回两次，一次继续执行父进程，一次进入执行子进程。

## Python 代码举例

    import os
    pid = os.fork()
    if pid == 0:
        print("我是子进程我的pid是:(%s),俺老爹是(%s)"%(os.getpid(),os.getppid()))
    else:
        print("俺是老爹(%s)俺有个儿子:(%s)"%(os.getpid(),pid))

----

    俺是老爹(20627)俺有个儿子:(20628)
    我是子进程我的pid是:(20628),俺老爹是(20627)

从这个示例代码中不难看出os.fork()确实返回了两次。

这两个返回值一个是子进程的pid 还有一个是 0 如果是负数表示 fork 失败了。

